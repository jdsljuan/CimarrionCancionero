<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Salmos - Una Solo Igles√≠a</title>
    <style>
        @font-face {
            font-family: "Sanchez Ita";
            src: url("./fonts/Sanchezregular-ita.otf");
        }
        @font-face {
            font-family: "Sanchez";
            src: url("./fonts/Sanchezregular.otf");
        }
        @font-face {
            font-family: "Batuphat";
            src: url("./fonts/Batuphat\ Script.otf");
        }
        @font-face {
            font-family: "Batuphat Ex";
            src: url("./fonts/Batuphat\ Script\ Extrude.otf");
        }
        body{
            margin: 0px;
            padding: 0px;
            background-color: black;
            overflow-x: hidden;
            box-sizing: border-box;
        }
        .stage{
            background-color: black;
            color: #ffffff;
            width: 100vw;
            min-width: 100vw;
            padding: 40px 80px 80px 80px;
            align-items: center;
            box-sizing: border-box;
            line-height: 1.8em;
        }
        #salmo{
            margin-top: 30px;
            text-align: justify;
            font-weight: 100;
            font-family: 'Sanchez';
        }

        #number{
            margin-top: 40px;
            text-align: center;
            text-shadow: 1px 1px 50px lightslategray;
            font-family: 'Batuphat';
            font-size: 2.5em;
        }
        #salmo > span.ver {
            font-family: 'Batuphat';
            font-size: 1.5em;
        }
        #btn-darkmode{
            background-image: url("img/dark_mode.svg");
            width: 40px;
            height: 40px;
            background-position: center;
        }

        @media screen and (max-width:720px){
            .stage{
                padding: 60px 40px 40px 40px;
            }
        }
    </style>
</head>
<body>
    <div id="stage" class="stage" ondblclick="getSalmo()">
        <div id="btn-darkmode" onclick="toggleTheme()"></div>
        <div id="salmo"></div>
        <div id="number"></div>
    </div>
</body>
<script>

    let salmos = [];
    function initVisor(){
        salmos = [];
        for (let index = 1; index < 151; index++) {
            salmos.push(index);        
        }
        toggleTheme();
        getSalmo();
    }

    function getSalmo() {
        let nxt = salmos[parseInt(Math.random(salmos.length)*100)];
        setContent("number", "Salmo "+nxt);
        let url = "./Recursos/Salmos/Esp_"+nxt+".txt";
        //let url = "https://jdsljuan.github.io/UnaSolaIglesia/Recursos/Salmos/Esp_"+nxt+".txt";
        var xhr = new XMLHttpRequest();
        xhr.open("GET", url, false);  // false means synchronous
        xhr.send();
        if (xhr.readyState === 4 && xhr.status === 200) {
            setContent("salmo",xhr.responseText);
            processSalmoNumbers();
        }
    }

    function setContent(id, text){
        document.getElementById(id).innerText = text;
    }

    function processSalmoNumbers(){
        var paragraph = document.getElementById("salmo");
        var regex = /([1-9]|[1-9][0-9]|100)\b/g;
        var matches = paragraph.textContent.match(regex);
        for (var i = 0; i < matches.length; i++) {
        var span = document.createElement("span");
        span.classList.add("ver");
        span.textContent = matches[i];
        paragraph.innerHTML = paragraph.innerHTML.replace(matches[i], span.outerHTML);
        }
    }

    let __darkThemeOn = true;
    function toggleTheme(){
        if(__darkThemeOn){
            document.getElementById("stage").style.color = "black";  
            document.getElementById("stage").style.backgroundColor = "white";
            document.body.style.backgroundColor = "white";
            document.getElementById("btn-darkmode").style.filter = "invert(0)";
            __darkThemeOn = false;
        }else{
            document.getElementById("stage").style.color = "white";  
            document.getElementById("stage").style.backgroundColor = "black";
            document.body.style.backgroundColor = "black";
            document.getElementById("btn-darkmode").style.filter = "invert(1)";
            __darkThemeOn = true;
        }
    }

    initVisor();

</script>
</html>